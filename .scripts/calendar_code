#!/bin/zsh
autoload +X _complete
autoload -U compinit && compinit
source /usr/bin/aws_zsh_completer.sh
functions[_original_complete]=$functions[_complete]
_complete () {
  unset 'compstate[vared]'
  _original_complete "$@"
}
FILTER=""
LINELIMIT=18
while true; do
        clear
        unbuffer task list $FILTER | head -n $LINELIMIT
        task calendar
        COMMAND=''
        vared COMMAND
        if [[ $COMMAND = "q" ]] || [[ $COMMAND = "Q" ]]
                then break
            else
                if [[ $COMMAND == "filter"* ]] then
                        WORDTOREMOVE="filter "
                        FILTER=${COMMAND//$WORDTOREMOVE/}
                        if [[ $FILTER == *"all"* ]] then
                                FILTER=""
                        else
                                FILTER="project:"$FILTER
                        fi
                elif [[ $COMMAND == "limit"* ]] then
                        WORDTOREMOVE="limit "
                        LINELIMIT=${COMMAND//$WORDTOREMOVE/}
                        if [[ $LINELIMIT == *"all"* ]] then
                                LINELIMIT=100
                        else
                                LINELIMIT=$((LINELIMIT + 2))
                        fi
                else
                       eval $COMMAND
                fi
        fi
done
